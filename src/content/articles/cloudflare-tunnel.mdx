---
title: "Cloudflare Tunnel ã‚’åˆ©ç”¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆã‚’ä¸€æ™‚çš„ã«å…¬é–‹ã™ã‚‹"
description: "Cloudflare Tunnel ã‚’åˆ©ç”¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆã‚’ä¸€æ™‚çš„ã«å…¬é–‹ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™"
pubDate: "2024/12/01"
emoji: "ğŸŒ"
---

ã“ã®è¨˜äº‹ã¯å‚™å¿˜éŒ²ã§ã™

1. Cloudflare Tunnel ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

ã“ã®éƒ¨åˆ†ã¯çœç•¥

2. Cloudflare Tunnel ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹

```shell
cloudflared tunnel login
```

ãƒ­ã‚°ã‚¤ãƒ³ãŒæˆåŠŸã™ã‚‹ã¨ã€èªè¨¼æƒ…å ±ãŒ `~/.cloudflared/cert.pem` ã«ä¿å­˜ã•ã‚Œã¾ã™

3. ãƒˆãƒ³ãƒãƒ«ã‚’ä½œæˆã™ã‚‹

```shell
cloudflared tunnel create <TUNNEL_NAME>
```

ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãƒˆãƒ³ãƒãƒ«ã®UUIDãŒç”Ÿæˆã•ã‚Œã€å¯¾å¿œã™ã‚‹JSONãƒ•ã‚¡ã‚¤ãƒ«ãŒ `~/.cloudflared/` ã«ä¿å­˜ã•ã‚Œã¾ã™

4. ãƒ‰ãƒ¡ã‚¤ãƒ³ã® DNS ã« CNAME ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹

```shell
cloudflared tunnel route dns <TUNNEL_NAME> <YOUR_DOMAIN>

```

5. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

```shell
touch ~/.cloudflared/config.yml
```

```yaml
tunnel: <TUNNEL_UUID>
credentials-file: /root/.cloudflared/<TUNNEL_UUID>.json
ingress:
  - hostname: <YOUR_DOMAIN>
    service: http://localhost:80
  - service: http_status:404
```

`hostname` ã«ã¯å…ˆã»ã©è¨­å®šã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ã€`service` ã«ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§å…¬é–‹ã—ãŸã„ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒãƒ¼ãƒˆã‚’æŒ‡å®šã—ã¾ã™

> **ã“ã“ã§ç§çš„ã®ãƒã‚¤ãƒ³ãƒˆ** `~/.zshrc` ã«æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™

```shell
# Cloudflare Tunnel
alias tunnel="_tunnel"
function _tunnel()
{
    if [ -z "$1" ]; then
        echo "Please provide a port number (80 or 3000)."
        return 1
    fi

    case $1 in
        80)
            cloudflared tunnel --config ~/.cloudflared/config_80.yml run MacBook-Pro
            ;;
        3000)
            cloudflared tunnel --config ~/.cloudflared/config_3000.yml run MacBook-Pro
            ;;
        *)
            echo "Invalid port number. Only 80 and 3000 are allowed."
            return 1
            ;;
    esac
}
```

ã¾ãŸã“ã‚Œã«å¿œã˜ã¦ã€`~/.cloudflared/config_80.yml` ã¨ `~/.cloudflared/config_3000.yml` ã‚’ä½œæˆã—ã¾ã™

6. ãƒˆãƒ³ãƒãƒ«ã‚’èµ·å‹•ã™ã‚‹

```shell
tunnel 80
```

ã“ã‚Œã§ã€`https://<YOUR_DOMAIN>` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆãŒä¸€æ™‚çš„ã«å…¬é–‹ã•ã‚Œã¾ã™
